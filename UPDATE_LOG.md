# Update Logs

## v1.7.1 (2026/02/19) - 安定性向上 ＆ 内部構造の最適化
- **[System]** `package.json` のバージョン不整合を解消（v1.4.0 -> v1.7.1）。
- **[Maintenance]** 定期アップデート・プロセスの基盤を整備。
- **[Optimization]** 内部的な依存関係とエラーハンドリングの微調整。

---

## v1.7.0 (2026/02/18) - オーラ・システム ＆ AIコンシェルジュ

- **[Feature]** 「オーラ・システム」を実装。VC滞在時間（生涯合計）に応じたカスタムロールの自動付与が可能に。
- **[Feature]** 「AIコミュニティ・ヘルス・レーダー」を実装。一定期間活動のないメンバーへの丁寧なAIアドバイスを自動生成。
- **[Feature]** 「サーバー・インサイト ＆ 戦略レポート」を実装。サーバーの成長や活性度をAIが分析し、運営アドバイスを週単位で配信。
- **[Dashboard]** 設定画面にオーラ名称、AIアドバイス、運営アドバイスの各カスタマイズ項目を追加。
- **[Dashboard]** アクティビティ監査ページに「累計VC時間」の項目を追加。
- **[Optimization]** `member_stats` テーブルによる一元的なアクティビティ管理の導入。


## v1.6.9 (2026/02/16) - 鉄壁の要塞・最終安定化アップデート

- **[System]** 内部監査に基づき全システムの安定性を強化（メモリ浄化 ＆ セキュリティ・ガード）。
- **[Optimization]** 中央集権的な `CacheManager` への移行。TTLと最大保持数（LRU）の導入により、メモリリークの可能性を完全に排除。
- **[Security]** ダッシュボードAPIへのCSRF保護（Iron Aegis）を実装。お嬢の設定を外部の攻撃から「絶対防御」します。
- **[Hardening]** アンチ・レイド保護エンジンの内部Mapにサイズ制限を適用。大規模な攻撃時でもボットの安定性を維持。
- **[Maintenance]** 全自動キャッシュ管理と定時DBクリーンアップにより、手動メンテナンスの手間を極限まで削減。
+
+## v1.4.2 (2026/02/16) - 特典紹介ページの刷新 ＆ 機能制限の厳格化
+- **[UI/UX]** 特典紹介ページのレイアウトを大幅刷新。タブ切り替えを廃止し、プランの特徴を凝縮した「概要カード」を横並びで表示するように変更。
+- **[Security]** ティアごとの機能制限（ティア・ゲート）をプログラムレベルで再定義・厳格化。
+    - **修正**: Pro+限定機能（CSV出力、メンバー監査、自己紹介ゲート）がProプランで一部利用可能だった問題を解消。
+    - **Fix**: Pro+プランでアンチ・レイド保護が定義漏れにより無効化されていた不具合を修正。
+    - **UX**: 統計表示の期間制限（Pro以下は7日間）をAPIレベルで正確に適用。

## v1.4.0 (2026/02/16) - 機能ロードマップの本格統合とCSV機能の高度化
- **[Feature]** ロードマップ機能を全プランへ正式統合。
    - Proプランに「アンチ・レイド保護」、Pro+プランに「自動自己紹介ゲート」を標準搭載。
- **[Fix]** Pro+プランでCSV出力ボタンが表示されない不具合を修正。
- **[Dashboard]** CSV出力に「NG（不合格者）のみ」のフィルタリング機能を追加。
- **[Protection]** スパム保護に「メッセージ連投制限（レートリミット）」を追加。短時間の過度な送信を自動検知します。
- **[UI]** プラン紹介ページの価格を最新版（Pro: ¥680, Pro+: ¥1,800）に更新。

## v1.3.9 (2026/02/16) - ヘルプチップの表示不具合修正
- **[Fix]** 設定画面でツールチップが正常に表示されない問題を修正。
    - 親要素のレイアウト干渉を解消し、解説文が隠れないよう調整。
    - ツールチップの重なり順位（z-index）を最適化。

## v1.3.8 (2026/02/16) - UI/UXの改善（ヘルプツールチップの追加）
- **[UI/UX]** ダッシュボードとサーバー設定の各項目にヘルプチップ（？）を追加。
    - 各機能の役割をホバーで確認できるようになり、利便性が向上。
    - 日本語・英語の両言語で適切な説明文が表示されるよう対応。
    - プレミアムな質感のツールチップデザインを採用。

## v1.3.7 (2026/02/16) - スキャン重複投稿の防止強化
- **[Fix]** `/scan` コマンド等による過去ログ復元時の重複投稿防止ロジックを強化。
    - メッセージのフェッチ件数を増加（100件）し、広範囲の重複を検知可能に。
    - 比較アルゴリズムにフッターテキストを追加し、通常ログと復元ログの判別精度を向上。
    - コンソールログにスキップ時の詳細を出力するように改善。

## v1.3.6 (2026/02/16) - 統計表示の正確化と利便性向上
- **[Fix]** ヒートマップおよび成長トレンドの集計ロジックを修正。
    - 選択した「月」がグラフに反映されない不備を解消。
    - データの存在しない時間帯の集計が不安定だった問題を修正。
- **[Dashboard]** グラフ表示のUX改善。
    - データが0の際の表示を安定化させ、無意味な空白にならないよう調整。
    - API呼び出しの効率化により、リロード速度を向上。

## v1.3.5 (2026/02/15) - Bot構造の近代化
- **[Refactor]** ビューレンダリングシステムをEJSテンプレートエンジンへ完全移行。
    - `services/views.js` の軽量化（1,100行超 -> 約60行）。
    - ページごとのテンプレート分離による保守性の向上。
- **[i18n]** 翻訳データの外部JSON化を実現。
    - `locales/ja.json`, `locales/en.json` へのデータ抽出。
- **[Test]** 自動テスト環境 (Jest) の構築。
    - コアロジックの品質担保。

## v1.3.4 (2026/02/13) - メンテナンス強化

### 🚀 主要なアップデートまとめ
v1.3.0からv1.3.4にかけて実施された、UIの最適化と安定性向上のまとめです。

- **ダッシュボードの超軽量化**: スクロール不要の「Ultra Compact」レイアウトの導入。
- **視認性の極限向上**: 統計数値とグラフ（ヒートマップ、成長トレンド）を拡大し、プラン名を「Pro/Pro+」へ簡略化。
- **管理 UI の刷新**: 設定項目を整理し、アコーディオンレイアウトとヘルプツールチップを追加。
- **システムの安定化**: VCエンゲージメントの不具合修正、統計データの正確化、および細かなバグの徹底排除。

---

# Akatsuki Bot v1.3.4 リリースノート

## 🚀 バージョン情報
- **Version**: 1.3.4
- **Date**: 2026-02-13

## ✨ UI・機能の最終微調整とお嬢専用解放
- **プラン表示の簡略化**: プラン名から (Monthly) や (Yearly) の表記を削除し、「Pro」「Pro+」とシンプルに表示するようにしました。
- **ダッシュボードの視認性向上**:
    - **チャートのスケーリング**: グラフの基点を `50` に調整し、アクティビティの動きをより分かりやすく表示します（50を超えると自動拡張）。
    - **統計数字の拡大**: サマリー統計の数値を大きくし、一目で把握できるようにしました。
    - **グラフサイズの拡大**: ヒートマップと成長トレンドをさらに大きく調整しました。
- **VCエンゲージメントの修正**: チャンネル選択が出ない不備と、保存設定が表示されないバグを完全に修正しました。
- **特定サーバーの先行解放**: 指定サーバーにてアルファ機能を継続して提供中。

---

# Akatsuki Bot v1.3.3 リリースノート

## 🚀 バージョン情報
- **Version**: 1.3.3
- **Date**: 2026-02-13

## ✨ ダッシュボードの極限圧縮 (Ultra Compact)
- **スクロールゼロの実現**: サーバー選択、月選択、統計サマリー、プラン情報をすべて1行のヘッダーに統合。開いた瞬間にグラフまで視認できる超コンパクトレイアウトを導入しました。
- **グラフスケーリングの調整**: Y軸の初期最大値を `500` に引き下げ、小規模サーバーでもデータの変化が直感的に分かるように改善しました（数値が超える場合は自動拡張）。
- **統計表示の軽量化**: 従来の数字ボックスを廃止し、省スペースなテキストベースのサマリーに変更しました。

---

# Akatsuki Bot v1.3.2 リリースノート

## 🚀 バージョン情報
- **Version**: 1.3.2
- **Date**: 2026-02-13

## ✨ ダッシュボード・レイアウトの最適化
- **グラフのコンパクト化**: メンバー推移やVCアクティビティのグラフが高すぎて目障りだったため、縦幅を `300px` から `200px` に大幅に縮小しました。
- **レイアウトの安定化**: グラフが画面幅一杯に広がりすぎないよう、最大幅を `900px` に制限して中央寄せしました。

---

# Akatsuki Bot v1.3.1 リリースノート

## 🚀 バージョン情報
- **Version**: 1.3.1
- **Date**: 2026-02-13

## ✨ UI刷新と統計ロジックの改善
- **設定画面のアコーディオン化**: 設定項目を「NGワード管理」と「基本構成」に整理し、アコーディオンレイアウトで視認性を向上させました。
- **ヘルプツールチップの導入**: 各設定項目に丁寧な中立的説明を表示する「？」アイコンを追加しました。
- **統計データの正確化**: 退出者数やタイムアウト実行数をデータベースから正しく取得し、ダッシュボードの要約パネルに反映するように修正しました。
- **バグ修正**: 設定画面でルールを追加する際に発生していた `addRoleRule is not defined` エラーを解消しました。

---

# Akatsuki Bot v1.3.0 リリースノート

---

# Akatsuki Bot v1.2.1 リリースノート

## 🚀 バージョン情報
- **Version**: 1.2.1
- **Date**: 2026-02-13

## ✨ 慈悲のアップデート（Tier調整）
- **Proプランへの機能開放**: 「アンチ・レイド警告」と「成長トレンド（直近7日間）」をProプランでも利用可能にしました。
- **UI/UXの刷新**: ダッシュボードや機能紹介ページの比較表を、プラン間の違いが直感的に分かるように整理。
- **内部ロジック修正**: `guildMemberAdd` イベントの条件分岐を修正し、ティアごとの機能制限が正確に動作するように改善。

---

# Akatsuki Bot v1.2.0 リリースノート

## 🚀 バージョン情報
- **Version**: 1.2.0
- **Date**: 2026-02-13

## ✨ 追加・変更機能
- **先進的自動モデレーションの導入**:
    - **メンション保護**: 短時間に大量のメンションを送信するユーザーを自動で制限します。
    - **アンチ・レイド**: 一定時間内の急激な参加者増加を検知し、管理者に警告を送信します。
    - **自動自己紹介ゲート**: 指定チャンネルに自己紹介を投稿すると、内容を判定して自動でロールを付与します。
- **サーバー分析ダッシュボードの拡充**:
    - **メンバー推移グラフ**: 過去14日間の参加・離脱トレンドを可視化。
    - **アクティビティ・ヒートマップ**: VC利用が活発な時間帯を24時間グラフで表示。
- **データベース拡張**: メンバーイベント、アンチレイド設定、自己紹介設定用の新規テーブル・カラムを追加。

---

# Akatsuki Bot v1.1.5 リリースノート

## 🚀 バージョン情報
- **Version**: 1.1.5
- **Date**: 2026-02-13

## ✨ 追加・変更機能
- **価格改定の実施**: 提供機能の充実と長期的な運営継続のため、有料プランの価格を改定しました。
    - **Pro**: 月額 680円
    - **Pro+**: 月額 1,800円
- **機能紹介ページの更新**: 最新の価格設定と、競合との比較情報をベースにした機能説明を反映しました。

### v1.4.1 (2026-02-16)
- **Freeプランの強化**:
    - NGワード登録上限を 5個から **10個** へ引き上げ。
    - **アンチ・レイド保護 (警告通知)** をFreeプランでも利用可能にアップグレード。
- **機能比較一覧の追加**: プランごとの違いを一目で比較できるテーブルを機能紹介ページに追加。
- **UI/UXの改善**: 比較表の項目順序を整理し、視認性を向上。

### v1.4.0 (2026-02-15)
- **ライセンス管理の統合**: `manage-license.js` へ統合。
- **機能紹介ページの更新**: 最新の価格設定と、競合との比較情報をベースにした機能説明を反映しました。

---

# Akatsuki Bot v1.1.4 リリースノート

## 🚀 バージョン情報
- **Version**: 1.1.4
- **Date**: 2026-02-13

## ✨ 追加・変更機能
- **管理ログ重複排除の強化**: `/scan` コマンド等で発生していたログの二重投稿問題を修正しました。タイムスタンプの比較精度を調整し、より確実に重複を検知できるよう改善しました。
- **Discord.js 非推奨警告の修正**: `ephemeral` オプションに関する非推奨警告を修正し、最新のAPI仕様（`MessageFlags`）に準拠させました。

---

# Akatsuki Bot v1.1.3 リリースノート

## 🚀 バージョン情報
- **Version**: 1.1.3
- **Date**: 2026-02-12

## ✨ 追加・変更機能
- **ログスキャン重複排除機能**: `/scan` コマンドでログを復元する際、既に同じ内容（ユーザー、時間、チャンネル、アクション）のログが存在する場合に重複して投稿されないように改善しました。
- **ログ投稿ロジックの改善**: 共通のログ投稿処理において、オプションで既存ログとの照合が可能になりました。

---

# Akatsuki Bot v1.1.2 リリースノート

## 🚀 バージョン情報
- **Version**: 1.1.2
- **Date**: 2026-02-12

## ✨ 追加・変更機能
- **アクティビティスキャンの最適化**: メンバー情報の取得時にキャッシュをより積極的に利用するようにし、Discord APIのレートリミット耐性を向上させました。
- **エラーハンドリングの強化**: レートリミットが発生した場合でも、可能であればキャッシュから前回のデータを表示するように修正しました。
- **ログのクリーンアップ**: 実行ログに出力されていた過剰な認証デバッグログを整理し、ログの視認性を改善しました。

---

# Akatsuki Bot v1.1.1 リリースノート

## 🚀 バージョン情報
- **Version**: 1.1.1
- **Date**: 2026-02-12

## ✨ 追加・変更機能
- **Proトライアル**: Proプランの基本機能を試用できる `Trial Pro` を追加しました。
    - 従来の `Trial Pro+` (高機能Pro+プラン相当) とは異なり、Dashboardのみの利用など、Proプラン契約時のイメージをつかみやすくするためのトライアル環境を提供します。
    - **自動期限設定**: ライセンス更新時に期限が指定されない場合、`Trial Pro` は14日間、`Trial Pro+` は7日間の試用期間が自動的に設定されるようになりました。
- **API認証の追加**: `/api/license/update` エンドポイントが `ADMIN_TOKEN` によるAPIキー認証に対応しました。これにより、外部システムからの自動ライセンス管理が可能になります。
- **スパム保護機能の追加**: 類似メッセージの連投を自動検知し、削除および自動キック（追放）を行う機能を追加しました。
    - 類似度85%以上のメッセージを5回連続で送信したユーザーを自動的にサーバーからキックします（Pro以上の特典）。
- **バグ修正**: ライセンス更新時のサーバー数制限チェックにおいて、数値以外の値が含まれる場合にエラーが発生する問題を修正しました。
- **ウェブダッシュボードの更新**: 機能比較表に「スパム保護」を追加し、トライアル期間や各種制限の表示を最新の仕様に合わせて修正しました。

---

# Akatsuki Bot v1.1.0 リリースノート

## 🚀 バージョン情報
- **Version**: 1.1.0
- **Date**: 2026-02-11

## ✨ 追加・変更機能
- **VCログ開放**: FreeプランでもVC入退室ログのスレッド化機能が利用可能になりました。
- **ログ設定の分離**: 内部的に「NGワードログ」と「VCログ」の権限管理を分離し、より柔軟なプラン設定に対応しました。

---

# Akatsuki Bot Update Log

## v1.4.3 (2026/02/16) - 1,000サーバー規模 対応への極限最適化
- **[Optimization]** データベース負荷を劇的に軽減する「書き込みバッチ化」システムを導入。ログやイベントの記録を5秒ごとに一括処理するように。
- **[Optimization]** メモリ管理の最適化（LRUキャッシュ）。アクティブなサーバーのデータを優先し、メモリ消費をシビアに抑制。
- **[Optimization]** NGワード判定の高速化。正規表現を事前コンパイルしてキャッシュすることで、CPU負荷を最小化。
- **[Optimization]** ボイス・セッションおよび入室カウントをメモリ管理に移行。頻繁なデータベース読み取りを排除。
- **[Performance]** 全主要イベントに「遅延読み込み（Lazy Loading）」を適用。必要な機能が使われるまで重いライブラリをロードしない構成に。
- **[Database]** クエリパフォーマンスを最大化するため、必要なインデックスをすべて再整備。


# Akatsuki Bot v1.0.0 正式リリース

## 🚀 バージョン情報
- **Version**: 1.0.0
- **Date**: 2026-02-11

## ✨ 主な変更点

### 🛠️ システム基盤・データベース
- **スキーマ統合**: データベースのカラム名を統一 (`server_id` → `guild_id`, `plan_tier` → `tier`) し、整合性を向上させました。
- **安定性向上**: `vc_sessions` テーブルのプライマリキー構造を修正し、パフォーマンスを改善しました。

### 💻 ダッシュボード & 管理コンソール
- **サブスクリプション管理**:
    - プラン（Free, Pro, Pro+）の編集が可能になりました。
    - 有効期限の短縮（負の値の入力）に対応しました。
- **ライセンス管理**:
    - 発行済みライセンスの使用状況（Issued / Used）が色分けされ、一目で分かるようになりました。
- **UI改善**:
    - ユーザー一覧にDiscordアバターとハンドル名が表示されるようになりました。

### 🤖 Bot機能
- **VCログ機能**:
    - 入室(IN)と退室(OUT)のログを別々のスレッドに分離し、視認性を高めました。
    - 過去のVCアクティビティを遡ってログ出力するスキャン機能を追加しました。
- **通知・アナウンス**:
    - 自動DM通知のロジックを修正し、正確に送信されるようにしました。
    - アナウンス作成機能を修正しました。
- **その他**:
    - CSVエクスポート機能の不具合を修正しました。
